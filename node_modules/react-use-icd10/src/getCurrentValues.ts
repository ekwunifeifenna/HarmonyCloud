import stringifyDiagnosis from './stringifyDiagnosis'
import { ICD10Object } from './types'

const getCurrentValues = ({ id = '', stringify = false } = {}):
  | undefined
  | string
  | ICD10Object[] => {
  if (typeof window !== 'undefined') {
    const elem: any = document.getElementById(id)
    if (!elem) return
    const exists =
      !!elem.elements && elem.elements['diagnosis[0].code'] !== undefined
    if (!exists) return stringify ? '' : []
    let hasEnded = false
    let count = 0
    const diagnosis = []
    while (!hasEnded) {
      const code = elem.elements
        ? elem.elements[`diagnosis[${count}].code`]
        : { value: '' }
      if (code !== undefined) {
        const description = elem.elements
          ? elem.elements[`diagnosis[${count}].description`]
          : { value: '' }
        const comment = elem.elements
          ? elem.elements[`diagnosis[${count}].comment`]
          : { value: '' }
        diagnosis.push({
          code: code.value,
          description: description.value,
          comment: comment.value,
        })
        count++
      } else hasEnded = true
    }
    return stringify ? stringifyDiagnosis(diagnosis) : diagnosis
  }
  return stringify ? '' : []
}

export default getCurrentValues
