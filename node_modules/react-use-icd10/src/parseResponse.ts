import reduce from 'lodash.reduce'
import { ResponseData, ReducerObject, CodeDescription } from './types'

const handleReduce = (
  acc: ReducerObject,
  [code, description]: CodeDescription,
): ReducerObject => {
  if (!acc.hasOwnProperty(code)) acc[code] = description
  return acc
}

const parseResponse = (data: ResponseData) => {
  if (data) {
    const totalResults: number = data[0]
    const codes: string[] = data[1]
    const codesAndNames: CodeDescription[] = data[3]
    return {
      results: reduce(codesAndNames, handleReduce, {}),
      total: totalResults,
      codes,
    }
  }
  return null
}

export default parseResponse
